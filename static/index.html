<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1">

	<title>Weather - Northern Arizona University</title>

	<!-- Loading third party fonts -->
	<link href="http://fonts.googleapis.com/css?family=Roboto:300,400,700|" rel="stylesheet" type="text/css">
	<link href="fonts/font-awesome.min.css" rel="stylesheet" type="text/css">

	<!-- Loading main css file -->
	<link rel="stylesheet" href="style.css">

	<!--[if lt IE 9]>
	<script src="js/ie-support/html5.js"></script>
	<script src="js/ie-support/respond.js"></script>
	<![endif]-->


</head>
<body>
<div class="site-content">
	<div class="site-header">
		<div class="container">
			<a href="index.html" class="branding">
				<img src="images/logo.png" alt="" class="logo">
				<div class="logo-type">
					<h1 class="site-title">Northern Arizona University</h1>
				</div>
			</a>

			<div class="mobile-navigation"></div>

		</div>
	</div> <!-- .site-header -->
	<div class="forecast-table">
		<div class="container">
			<div class="forecast-container">
				<div class="forecast day5">
					<div class="forecast-header">
						<div class="day">Sunday</div>
					</div> <!-- .forecast-header -->
					<div class="forecast-content">
						<div class="forecast-icon">
							<img src="images/icons/icon-3.svg" alt="" width=48>
						</div>
						<div class="degree"><span class="high_temp"></span><sup>o</sup>F</div>
						<small><span class="low_temp">18</span><sup>o</sup></small>
					</div>
				</div>
				<div class="forecast day4">
					<div class="forecast-header">
						<div class="day">Sunday</div>
					</div> <!-- .forecast-header -->
					<div class="forecast-content">
						<div class="forecast-icon">
							<img src="images/icons/icon-3.svg" alt="" width=48>
						</div>
						<div class="degree"><span class="high_temp"></span><sup>o</sup>F</div>
						<small><span class="low_temp">18</span><sup>o</sup></small>
					</div>
				</div>
				<div class="forecast day3">
					<div class="forecast-header">
						<div class="day">Sunday</div>
					</div> <!-- .forecast-header -->
					<div class="forecast-content">
						<div class="forecast-icon">
							<img src="images/icons/icon-3.svg" alt="" width=48>
						</div>
						<div class="degree"><span class="high_temp"></span><sup>o</sup>F</div>
						<small><span class="low_temp">18</span><sup>o</sup></small>
					</div>
				</div>
				<div class="forecast day2">
					<div class="forecast-header">
						<div class="day">Sunday</div>
					</div> <!-- .forecast-header -->
					<div class="forecast-content">
						<div class="forecast-icon">
							<img src="images/icons/icon-3.svg" alt="" width=48>
						</div>
						<div class="degree"><span class="high_temp"></span><sup>o</sup>F</div>
						<small><span class="low_temp">18</span><sup>o</sup></small>
					</div>
				</div>
				<div class="forecast day1">
					<div class="forecast-header">
						<div class="day">Sunday</div>
					</div> <!-- .forecast-header -->
					<div class="forecast-content">
						<div class="forecast-icon">
							<img src="images/icons/icon-3.svg" alt="" width=48>
						</div>
						<div class="degree"><span class="high_temp"></span><sup>o</sup>F</div>
						<small><span class="low_temp">18</span><sup>o</sup></small>
					</div>
				</div>
				<div class="forecast today">
					<div class="forecast-header">
						<div class="day">Monday</div>
						<div class="date">6 Oct</div>
					</div> <!-- .forecast-header -->
					<div class="forecast-content">
						<div class="location">Flagstaff</div>
						<div class="degree">
							<div class="num"><span class="temperature"></span><sup>o</sup>F</div>
							<div class="forecast-icon">
								<img src="images/icons/icon-3.svg" alt="" width=90>
							</div>
						</div>
						<span><img src="images/icon-umberella.png" alt=""><span class="rain_count"></span></span>
						<span><img src="images/icon-wind.png" alt=""><span class="wind_speed"></span></span>
						<span><img src="images/icon-compass.png" alt=""><span class="wind_direction"></span></span>
					</div>
				</div>
			</div>
		</div>
	</div>
	<main class="main-content">
		<div class="fullwidth-block">
			<div class="container">
				<h2 class="section-title">Data Charts</h2>
				<div class="row">
					<div class="col-md-3 col-sm-6">
						<div class="live-camera">
							<canvas id="temperature-chart" width="275" height="220"></canvas>
							<h3 class="location">Temperature (F)</h3>
							<small class="date">Past 30 Hours</small>
						</div>
					</div>
					<div class="col-md-3 col-sm-6">
						<div class="live-camera">
							<canvas id="windchill-chart" width="275" height="220"></canvas>
							<h3 class="location">Wind Chill (F)</h3>
							<small class="date">Past 30 Hours</small>
						</div>
					</div>
					<div class="col-md-3 col-sm-6">
						<div class="live-camera">
							<canvas id="dewpoint-chart" width="275" height="220"></canvas>
							<h3 class="location">Dew Point (F)</h3>
							<small class="date">Past 30 Hours</small>
						</div>
					</div>
					<div class="col-md-3 col-sm-6">
						<div class="live-camera">
							<canvas id="windspeed-chart" width="275" height="220"></canvas>
							<h3 class="location">Wind Speed (mph)</h3>
							<small class="date">Past 30 Hours</small>
						</div>
					</div>
					<div style="padding-bottom: 100px;"></div>
					<div class="row">
						<div class="col-md-3 col-sm-6">
							<div class="live-camera">
								<canvas id="humidity-chart" width="275" height="220"></canvas>
								<h3 class="location">Humidity (%)</h3>
								<small class="date">Past 30 Hours</small>
							</div>
						</div>
						<div class="col-md-3 col-sm-6">
							<div class="live-camera">
								<canvas id="sealevel-chart" width="275" height="220"></canvas>
								<h3 class="location">Sea Level Barometric Pressure (in Hg)</h3>
								<small class="date">Past 30 Hours</small>
							</div>
						</div>
						<div class="col-md-3 col-sm-6">
							<div class="live-camera">
								<canvas id="rain-chart" width="275" height="220"></canvas>
								<h3 class="location">Hourly Rain</h3>
								<small class="date">Past 30 Hours (melting snow values: possible)</small>
							</div>
						</div>
						<div class="col-md-3 col-sm-6">
							<div class="live-camera">
								<canvas id="winddirection-chart" width="275" height="220"></canvas>
								<h3 class="location">Wind Direction</h3>
								<small class="date">Past 30 Hours</small>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="fullwidth-block" data-bg-color="#262936">
			<div class="container">
				<div class="row">
					<div class="col-md-4">
						<div class="news">
							<div class="date">06.10</div>
							<h3><a href="#">Doloremque laudantium totam sequi </a></h3>
							<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Illo saepe assumenda dolorem
								modi, expedita voluptatum ducimus necessitatibus. Asperiores quod reprehenderit
								necessitatibus harum, mollitia, odit et consequatur maxime nisi amet doloremque.</p>
						</div>
					</div>
					<div class="col-md-4">
						<div class="news">
							<div class="date">06.10</div>
							<h3><a href="#">Doloremque laudantium totam sequi </a></h3>
							<p>Nobis architecto consequatur ab, ea, eum autem aperiam accusantium placeat vitae facere
								explicabo temporibus minus distinctio cum optio quis, dignissimos eius aspernatur fuga.
								Praesentium totam, corrupti beatae amet expedita veritatis.</p>
						</div>
					</div>
					<div class="col-md-4">
						<div class="news">
							<div class="date">06.10</div>
							<h3><a href="#">Doloremque laudantium totam sequi </a></h3>
							<p>Enim impedit officiis placeat qui recusandae doloremque possimus, iusto blanditiis, quam
								optio delectus maiores. Possimus rerum, velit cum natus eos. Cumque pariatur beatae
								asperiores, esse libero quas ad dolorem. Voluptates.</p>
						</div>
					</div>
				</div>
			</div>
		</div>
	</main> <!-- .main-content -->
</div>

<script src="js/jquery-1.11.1.min.js"></script>
<script src="js/plugins.js"></script>
<script src="js/app.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>


<script>

	$.get("./previous_week", function (data) {
		$(".today > .forecast-header > .day").text(data.today.date)
		$(".today > .forecast-content > .degree > .num > .temperature").text(Math.round(data.today.current_temp));
		$(".today > .forecast-content > span > .rain_count").text(data.today.rain_count);
		$(".today > .forecast-content > span > .wind_direction").text(data.today.wind_direction);
		$(".today > .forecast-content > span > .wind_speed").text(data.today.wind_speed);



		for(var num = 1; num < 6; num++){
			if(data[num] !== undefined){
				$(".day" + num + " > .forecast-header > .day").text(data[num].the_date);
				$(".day" + num + " > .forecast-content > .degree > .high_temp").text(data[num].high_temp);
				$(".day" + num + " > .forecast-content > small > .low_temp").text(data[num].low_temp);
			}
		}
	});

</script>

<script>


	$.get("./get_data?start_date=" + new Date(Date.now() - (60*60*30*1000)).toISOString(), function (data) {
		console.log(data);
		var hourlyReports = {
			labels: [],
			tempArray: [],
			windChill: [],
			dewPoint: [],
			windSpeed: [],
			humidity: [],
			seaLevel: [],
			rain: []
		};
		for (var i = 0; i < 24; i++) {
			var sums = {
				temp: 0,
				windC: 0,
				dewP: 0,
				windS: 0,
				humidity: 0,
				seaL: 0,
				rain: 0
			};

			for(var j = 0; j < 30; j++) {
				if(data[(i*30) + j] !== undefined) {
					sums.temp += data[(i * 30) + j].temperature;
					sums.windC += data[(i * 30) + j].wind_chill;
					sums.dewP += data[(i * 30) + j].dew_point;
					sums.windS += data[(i * 30) + j].wind_speed;
					sums.humidity += data[(i * 30) + j].humidity;
					sums.seaL += data[(i * 30) + j].barometer;
					if(sums.rain < data[(i*30) + j].hourly_rain)
						sums.rain += data[(i * 30) + j].hourly_rain;
				}
			}
			if(data[i*30] !== undefined) {
				var tmp = new Date(data[i * 30].timecode);
				hourlyReports.labels.push(tmp.getHours() + ":" + tmp.getMinutes());
			} else {
				hourlyReports.labels.push("00:00");
			}
			hourlyReports.tempArray.push(sums.temp / 30);
			hourlyReports.windChill.push(sums.windC / 30);
			hourlyReports.dewPoint.push(sums.dewP / 30);
			hourlyReports.windSpeed.push(sums.windS / 30);
			hourlyReports.humidity.push(sums.humidity / 30);
			hourlyReports.seaLevel.push(sums.seaL / 30);
			hourlyReports.rain.push(sums.rain / 30);
		}
		hourlyReports.labels.reverse();
		hourlyReports.tempArray.reverse();
		hourlyReports.windChill.reverse();
		hourlyReports.dewPoint.reverse();
		hourlyReports.windSpeed.reverse();
		hourlyReports.humidity.reverse();
		hourlyReports.tempArray.reverse();
		hourlyReports.tempArray.reverse();

		var labels = [];
		for(var label in hourlyReports) {
			if(hourlyReports.hasOwnProperty(label)) {
				labels.push(label);
			}
		}
		new Chart(document.getElementById("temperature-chart"), {
			type: 'line',
			data: {
				labels: hourlyReports.labels,
				datasets: [{
					data: hourlyReports.tempArray,
					label: "",
					borderColor: "#3e95cd",
					fill: false
				}]
			},
			options: {
				legend: {
					display: false
				},
				title: {
					display: false,
					text: 'Temperature'
				}
			}
		});

		new Chart(document.getElementById("windchill-chart"), {
			type: 'line',
			data: {
				labels: hourlyReports.labels,
				datasets: [{
					data: hourlyReports.windChill,
					label: "",
					borderColor: "#3e95cd",
					fill: false
				},
				]
			},
			options: {
				legend: {
					display: false
				},
				title: {
					display: false,
					text: 'Wind Chill'
				}
			}
		});

		new Chart(document.getElementById("dewpoint-chart"), {
			type: 'line',
			data: {
				labels: hourlyReports.labels,
				datasets: [{
					data: hourlyReports.dewPoint,
					label: "",
					borderColor: "#3e95cd",
					fill: false
				},
				]
			},
			options: {
				legend: {
					display: false
				},
				title: {
					display: false,
					text: 'Dew Point'
				}
			}
		});

		new Chart(document.getElementById("windspeed-chart"), {
			type: 'line',
			data: {
				labels: hourlyReports.labels,
				datasets: [{
					data: hourlyReports.windSpeed,
					label: "",
					borderColor: "#3e95cd",
					fill: false
				},
				]
			},
			options: {
				legend: {
					display:
							false
				},
				title: {
					display: false,
					text: 'Wind Speed'
				}
			}
		});

		new Chart(document.getElementById("humidity-chart"), {
			type: 'line',
			data: {
				labels: hourlyReports.labels,
				datasets: [{
					data: hourlyReports.humidity,
					label: "",
					borderColor: "#3e95cd",
					fill: false
				},
				]
			},
			options: {
				legend: {
					display:
							false
				},
				title: {
					display: false,
					text: 'Humidity'
				}
			}
		});

		new Chart(document.getElementById("sealevel-chart"), {
			type: 'line',
			data: {
				labels: hourlyReports.labels,
				datasets: [{
					data: hourlyReports.seaLevel,
					label: "",
					borderColor: "#3e95cd",
					fill: false
				},
				]
			},
			options: {
				legend: {
					display:
							false
				},
				title: {
					display: false,
					text: 'Sea Level'
				}
			}
		});

		new Chart(document.getElementById("rain-chart"), {
			type: 'line',
			data: {
				labels: hourlyReports.labels,
				datasets: [{
					data: hourlyReports.rain,
					label: "",
					borderColor: "#3e95cd",
					fill: false
				},
				]
			},
			options: {
				legend: {
					display:false
				},
				title: {
					display: false,
					text: 'Hourly Rain'
				},
				scales: {
					yAxes: [{
						ticks: {
							min: 0
						}
					}]
				}
			}
		});




		var n, ne, se, s, sw, w, nw;
		n = ne = se = s = sw = w = nw = 0;
		var counter = 0;
		for (i = 0; i < data.length; i++) {
			if(data[i].wind_speed > 0) {
				if (data[i].wind_dir >= 0 && data[i].wind_dir < 22.5) n++;
				if (data[i].wind_dir >= 22.5 && data[i].wind_dir < 67.5) ne++;
				if (data[i].wind_dir >= 112.5 && data[i].wind_dir < 157.5) se++;
				if (data[i].wind_dir >= 157.5 && data[i].wind_dir < 202.5) s++;
				if (data[i].wind_dir >= 202.5 && data[i].wind_dir < 247.5) sw++;
				if (data[i].wind_dir >= 247.5 && data[i].wind_dir < 292.5) w++;
				if (data[i].wind_dir >= 292.5 && data[i].wind_dir < 337.5) nw++;
				counter++;
			}
		}

		n = Math.round(n/counter * 100);
		ne = Math.round(ne/counter * 100);
		se = Math.round(se/counter * 100);
		s = Math.round(s/counter * 100);
		sw = Math.round(sw/counter * 100);
		w = Math.round(w/counter * 100);
		nw = Math.round(nw/counter * 100);
		console.log(n);
		console.log(ne);
		console.log(se);
		console.log(s);


		new Chart(document.getElementById("winddirection-chart"), {
			type: 'pie',
			data: {
				labels: ["N", "NE", "SE", "S", "SW", "W", "NW"],
				datasets: [{
					label: "",
					backgroundColor: ["#3e95cd", "#8e5ea2","#3cba9f","#e8c3b9","#c45850"],
					data: [n, ne, se, s, sw, w, nw]
				}]
			},
			options: {
				title: {
					display: true,
					text: ''
				},
				legend: {
					position: 'right'
				},
				layout: {
					padding: {
						left: 0,
						right: 0,
						top: -20,
						bottom: 30
					}
				}
			}
		});

	});
</script>

</body>

</html>